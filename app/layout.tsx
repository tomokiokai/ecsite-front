import NavBar from './components/nav-bar';
import { cookies } from 'next/headers';
import './globals.css';

export const metadata = {
  title: 'Nextjs App',
  description: 'Generated by create next app',
}

async function getUserInfo() {
  const res = await fetch(`${process.env.NEXT_PUBLIC_RESTAPI_URL}/cookies`, {
    method: 'GET',
    credentials: 'include',
    cache: 'no-store',
    headers: {
      Cookie: cookies().toString(),
    },
  });
console.log(res)
  if (!res.ok) {
    throw new Error('Failed to fetch user info');
  }

  const cookieMap = await res.json();
  // userInfo クッキーの値が存在するか確認する
  const userInfoEncoded = cookieMap.userInfo;
  if (!userInfoEncoded) {
    // userInfo クッキーが存在しない場合は、null または適切なデフォルト値を返す
    return null;
  }
  const userInfoDecoded = decodeURIComponent(userInfoEncoded);
  try {
    const userInfo = JSON.parse(userInfoDecoded);
    console.log(userInfo);
    return userInfo;
  } catch (error) {
    // JSON.parse() でエラーが発生した場合の処理
    console.error('Failed to parse userInfo:', error);
    // ここでエラーを処理するか、null または適切なデフォルト値を返す
    return null;
  }
}

export default async function RootLayout({
  children,
}: {
  children: React.ReactNode
  }) {
  const userInfo = await getUserInfo();
  return (
    <html>
      <body className="pt-16">
        <NavBar userInfo={userInfo}/>
          {children}
      </body>
    </html>
  );
}
